trigger:
  branches:
    include:
      - master

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: GitHubSync

steps:
- checkout: self
  persistCredentials: true

- script: |
    git config --global user.name "Azure DevOps Bot"
    git config --global user.email "azure-bot@example.com"

    # ğŸ‘‡ğŸ‘‡ğŸ‘‡ Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ù†Ù†Ø´Ø¦ ÙØ±Ø¹ Ø¬Ø¯ÙŠØ¯ Ù…Ù†Ø¹Ø²Ù„ (orphan) Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ØªØ§Ø±ÙŠØ® Ù‚Ø¯ÙŠÙ…
    git checkout --orphan temp-branch
    git add -A
    git commit -m "Initial clean commit for GitHub sync"
    git branch -D master 2>/dev/null || echo "Master branch not exists, skipping delete."
    git branch -m master

    # Ø¥Ø¹Ø¯Ø§Ø¯ remote Ù„Ù€ GitHub
    git remote add github https://$(GITHUB_TOKEN)@github.com/mohamed200184/Bookify.git 2>/dev/null || git remote set-url github https://$(GITHUB_TOKEN)@github.com/mohamed200184/Bookify.git

    # Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙˆÙ…ÙŠØª Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ØªØ£ÙƒØ¯
    echo "Current commit: $(git rev-parse HEAD)"

    # Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù‚Ø³Ø±ÙŠ â€” Ù„Ø£Ù†Ù†Ø§ Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ±
    git push github master --force
  displayName: 'ğŸ”„ Push to GitHub'